import{ItemTypes as e}from"@minecraft/server";import{world as n}from"@minecraft/server";function t(e){return{dimension:e.dimension.id,x:e.x,y:e.y,z:e.z}}function i(e){return e.dimension.id+Math.floor(e.x).toString()+Math.floor(e.y).toString()+Math.floor(e.z).toString()}function r(e){const t=`fluffyalien_energisticscore:storage${e}`;return n.scoreboard.getObjective(t)??n.scoreboard.addObjective(t)}function o(e,n){if(e.hasParticipant(n))return e.getScore(n)}import{system as c,world as s}from"@minecraft/server";var a=s.getDimension("overworld"),f=new Map,u=new Map;function d(e){f.delete(e)}function l(e,n){a.runCommand(`scriptevent ${e} ${JSON.stringify(n)}`)}var p=0;async function g(e,n,t){const i=`${n}:ipc.internal.handler_response_listener${p.toString()}`;return p++,new Promise(((n,r)=>{const o=c.runTimeout((()=>{d(i),r(new Error(`invoke script event '${e}' timed out: did not recieve a response`))}),20);!function(e,n){f.set(e,n)}(i,(e=>{d(i),c.clearRun(o),n(e)})),l(e,{responseEvent:i,payload:t})}))}c.afterEvents.scriptEventReceive.subscribe((e=>{const n=f.get(e.id);if(n)return void n(JSON.parse(e.message));const t=u.get(e.id);if(t){const n=JSON.parse(e.message),i=t(n.payload);l(n.responseEvent,i)}}));var m,_=100,v=6400;function y(e){if(m)throw new Error("'init' has already been called");m=e}function b(){if(!m)throw new Error("'init' has not been called")}function h(){return!!e.get("fluffyalien_energisticscore:ui_disabled_storage_bar_segment")}function w(e){let t;var i,r;b(),e.handlers?.updateUi&&(t=`${e.description.id}__updateUiHandler`,i=t,r=t=>{return e.handlers.updateUi((i=t,{dimension:n.getDimension(i.dimension),x:i.x,y:i.y,z:i.z}));var i},u.set(i,r));l("fluffyalien_energisticscore:ipc.register_machine",{description:e.description,updateUiEvent:t})}function S(e){b();l("fluffyalien_energisticscore:ipc.register_storage_type",{id:e.id,color:e.color,name:e.name})}function O(e){l("fluffyalien_energisticscore:ipc.update_block_network",t(e))}function $(e){l("fluffyalien_energisticscore:ipc.update_block_adjacent_networks",t(e))}function E(e,n){return o(r(n),i(e))??0}function j(e,n,t){r(n).setScore(i(e),t)}function x(e,t){const r=i(e),c=o(function(e){const t=`fluffyalien_energisticscore:itemtype${e.toString()}`;return n.scoreboard.getObjective(t)??n.scoreboard.addObjective(t)}(t),r);if(void 0===c)return;const s=o(function(e){const t=`fluffyalien_energisticscore:itemcount${e.toString()}`;return n.scoreboard.getObjective(t)??n.scoreboard.addObjective(t)}(t),r);return s?{typeIndex:c,count:s}:void 0}function k(e,n,i){l("fluffyalien_energisticscore:ipc.set_item_in_machine_slot",{loc:t(e),slot:n,item:i})}function z(e,n,i){l("fluffyalien_energisticscore:ipc.queue_send",{loc:t(e),type:n,amount:i})}function M(e,n,t){const i=E(e,n)+t;i<=0||z(e,n,i)}function U(e){return b(),g("fluffyalien_energisticscore:ipc.get_registered_machine",m.namespace,e)}export{v as MAX_MACHINE_STORAGE,_ as STORAGE_AMOUNT_PER_BAR_SEGMENT,M as generate,x as getItemInMachineSlot,E as getMachineStorage,U as getRegisteredMachine,y as init,h as isBedrockEnergisticsCoreInWorld,z as queueSend,w as registerMachine,S as registerStorageType,k as setItemInMachineSlot,j as setMachineStorage,$ as updateBlockAdjacentNetworks,O as updateBlockNetwork};