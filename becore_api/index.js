import{ItemTypes as e}from"@minecraft/server";import{world as t}from"@minecraft/server";var n="0.1.0";function r(e){return{dimension:e.dimension.id,x:e.x,y:e.y,z:e.z}}function i(e){return e.dimension.id+Math.floor(e.x).toString()+Math.floor(e.y).toString()+Math.floor(e.z).toString()}function o(e){const n=`fluffyalien_energisticscore:storage${e}`;return t.scoreboard.getObjective(n)}function c(e,t){if(e.hasParticipant(t))return e.getScore(t)}function s(e){return function(e,t){return`[Bedrock Energistics Core API v${n}] ${e} ${t}`}("ERROR",e)}import{system as a,world as f}from"@minecraft/server";var u=f.getDimension("overworld"),d=new Map,l=new Map;function g(e){d.delete(e)}function p(e,t){u.runCommand(`scriptevent ${e} ${JSON.stringify(t)}`)}var m=0;async function y(e,t,n){const r=`${t}:ipc.internal.handler_response_listener${m.toString()}`;return m++,new Promise(((t,i)=>{const o=a.runTimeout((()=>{g(r),i(new Error(`invoke script event '${e}' timed out: did not recieve a response`))}),20);!function(e,t){d.set(e,t)}(r,(e=>{g(r),a.clearRun(o),t(e)})),p(e,{responseEvent:r,payload:n})}))}a.afterEvents.scriptEventReceive.subscribe((e=>{const t=d.get(e.id);if(t)return void t(JSON.parse(e.message));const n=l.get(e.id);if(n){const t=JSON.parse(e.message),r=n(t.payload);p(t.responseEvent,r)}}));var _,h=100,v=6400;function w(e){if(_)throw new Error(s("'init' has already been called"));_=e}function b(){if(!_)throw new Error(s("'init' has not been called"))}function $(){return!!e.get("fluffyalien_energisticscore:ui_disabled_storage_bar_segment")}function E(e){let n;var r,i;b(),e.handlers?.updateUi&&(n=`${e.description.id}__updateUiHandler`,r=n,i=n=>{return e.handlers.updateUi((r=n,{dimension:t.getDimension(r.dimension),x:r.x,y:r.y,z:r.z}));var r},l.set(r,i));p("fluffyalien_energisticscore:ipc.register_machine",{description:e.description,updateUiEvent:n})}function S(e){b();p("fluffyalien_energisticscore:ipc.register_storage_type",{id:e.id,category:e.category,color:e.color,name:e.name})}function x(e){p("fluffyalien_energisticscore:ipc.update_block_networks",r(e))}function O(e){p("fluffyalien_energisticscore:ipc.update_block_connectable_networks",r(e))}function k(e){p("fluffyalien_energisticscore:ipc.update_block_adjacent_networks",r(e))}function j(e,t){const n=o(t);if(!n)throw new Error(s(`trying to get machine storage of type '${t}' but that storage type does not exist`));return c(n,i(e))??0}function z(e,t,n){if(!e.isValid())return;if(n<0)throw new Error(s(`trying to set machine storage of type '${t}' to ${n.toString()} which is less than the minimum value (0)`));if(n>v)throw new Error(s(`trying to set machine storage of type '${t}' to ${n.toString()} which is greater than the maximum value (${v.toString()})`));const r=o(t);if(!r)throw new Error(s(`trying to set machine storage of type '${t}' but that storage type does not exist`));r.setScore(i(e),n)}function M(e,n){const r=i(e),o=c(function(e){const n=`fluffyalien_energisticscore:itemtype${e.toString()}`;return t.scoreboard.getObjective(n)??t.scoreboard.addObjective(n)}(n),r);if(void 0===o)return;const s=c(function(e){const n=`fluffyalien_energisticscore:itemcount${e.toString()}`;return t.scoreboard.getObjective(n)??t.scoreboard.addObjective(n)}(n),r);return s?{typeIndex:o,count:s}:void 0}function R(e,t,n){p("fluffyalien_energisticscore:ipc.set_item_in_machine_slot",{loc:r(e),slot:t,item:n})}function U(e,t,n){p("fluffyalien_energisticscore:ipc.queue_send",{loc:r(e),type:t,amount:n})}function J(e,t,n){const r=j(e,t)+n;r<=0||U(e,t,r)}function N(e){return b(),y("fluffyalien_energisticscore:ipc.get_registered_machine",_.namespace,e)}export{v as MAX_MACHINE_STORAGE,h as STORAGE_AMOUNT_PER_BAR_SEGMENT,J as generate,M as getItemInMachineSlot,j as getMachineStorage,N as getRegisteredMachine,w as init,$ as isBedrockEnergisticsCoreInWorld,U as queueSend,E as registerMachine,S as registerStorageType,R as setItemInMachineSlot,z as setMachineStorage,k as updateBlockAdjacentNetworks,O as updateBlockConnectableNetworks,x as updateBlockNetworks};