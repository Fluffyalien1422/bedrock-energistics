import{world as e}from"@minecraft/server";var n="0.1.0";function t(e){return{dimension:e.dimension.id,x:e.x,y:e.y,z:e.z}}function i(e){return e.dimension.id+Math.floor(e.x).toString()+Math.floor(e.y).toString()+Math.floor(e.z).toString()}function r(n){const t=`fluffyalien_energisticscore:storage${n}`;return e.scoreboard.getObjective(t)??e.scoreboard.addObjective(t)}function o(e,n){if(e.hasParticipant(n))return e.getScore(n)}function c(e){console.info(function(e,t){return`[Bedrock Energistics Core API v${n}] ${e} ${t}`}("INFO",e))}import{system as s,world as a}from"@minecraft/server";var f=a.getDimension("overworld"),u=new Map,d=new Map;function l(e){u.delete(e)}function p(e,n){f.runCommand(`scriptevent ${e} ${JSON.stringify(n)}`)}var g,m=0;async function v(e,n,t){const i=`${n}:ipc.internal.handler_response_listener${m.toString()}`;return m++,new Promise(((n,r)=>{const o=s.runTimeout((()=>{l(i),r(new Error(`invoke script event '${e}' timed out: did not recieve a response`))}),20);!function(e,n){u.set(e,n)}(i,(e=>{l(i),s.clearRun(o),n(e)})),p(e,{responseEvent:i,payload:t})}))}function _(e){if(g)throw new Error("'init' has already been called");g=e}function y(){if(!g)throw new Error("'init' has not been called")}function b(n){let t;var i,r;y(),c(`sending register machine event for '${n.description.id}' (from '${g.namespace}')`),n.handlers?.updateUi&&(t=`${n.description.id}__updateUiHandler`,i=t,r=t=>{return n.handlers.updateUi((i=t,{dimension:e.getDimension(i.dimension),x:i.x,y:i.y,z:i.z}));var i},d.set(i,r));p("fluffyalien_energisticscore:ipc.register_machine",{description:n.description,updateUiEvent:t})}function h(e){p("fluffyalien_energisticscore:ipc.update_block_network",t(e))}function $(e){p("fluffyalien_energisticscore:ipc.update_block_adjacent_networks",t(e))}function w(e,n){return o(r(n),i(e))??0}function S(e,n,t){r(n).setScore(i(e),t)}function O(n,t){const r=i(n),c=o(function(n){const t=`fluffyalien_energisticscore:itemtype${n.toString()}`;return e.scoreboard.getObjective(t)??e.scoreboard.addObjective(t)}(t),r);if(void 0===c)return;const s=o(function(n){const t=`fluffyalien_energisticscore:itemcount${n.toString()}`;return e.scoreboard.getObjective(t)??e.scoreboard.addObjective(t)}(t),r);return s?{type:c,count:s}:void 0}function E(e,n,t){p("fluffyalien_energisticscore:ipc.set_item_in_machine_slot",{loc:e,slot:n,item:t})}function j(e,n,i){p("fluffyalien_energisticscore:ipc.queue_send",{loc:t(e),type:n,amount:i})}function k(e,n,t){const i=w(e,n)+t;i<=0||j(e,n,i)}function x(e){return y(),v("fluffyalien_energisticscore:ipc.get_registered_machine",g.namespace,e)}s.afterEvents.scriptEventReceive.subscribe((e=>{const n=u.get(e.id);if(n)return void n(JSON.parse(e.message));const t=d.get(e.id);if(t){const n=JSON.parse(e.message),i=t(n.payload);p(n.responseEvent,i)}}));export{k as generate,O as getItemInMachineSlot,w as getMachineStorage,x as getRegisteredMachine,_ as init,j as queueSend,b as registerMachine,E as setItemInMachineSlot,S as setMachineStorage,$ as updateBlockAdjacentNetworks,h as updateBlockNetwork};