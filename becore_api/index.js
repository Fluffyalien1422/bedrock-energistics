import{ItemTypes as e}from"@minecraft/server";import{world as t}from"@minecraft/server";var n="0.1.0";function i(e){return{dimension:e.dimension.id,x:e.x,y:e.y,z:e.z}}function r(e){return e.dimension.id+Math.floor(e.x).toString()+Math.floor(e.y).toString()+Math.floor(e.z).toString()}function o(e){const n=`fluffyalien_energisticscore:storage${e}`;return t.scoreboard.getObjective(n)}function s(e,t){if(e.hasParticipant(t))return e.getScore(t)}function c(e){return function(e,t){return`[Bedrock Energistics Core API v${n}] ${e} ${t}`}("ERROR",e)}import{system as a,world as f}from"@minecraft/server";var u=f.getDimension("overworld"),l=new Map,d=new Map;function g(e){l.delete(e)}function p(e,t){u.runCommand(`scriptevent ${e} ${JSON.stringify(t)}`)}var m=0;async function y(e,t,n){const i=`${t}:ipc.internal.handler_response_listener${m.toString()}`;return m++,new Promise(((t,r)=>{const o=a.runTimeout((()=>{g(i),r(new Error(`invoke script event '${e}' timed out: did not recieve a response`))}),20);!function(e,t){l.set(e,t)}(i,(e=>{g(i),a.clearRun(o),t(e)})),p(e,{responseEvent:i,payload:n})}))}a.afterEvents.scriptEventReceive.subscribe((e=>{const t=l.get(e.id);if(t)return void t(JSON.parse(e.message));const n=d.get(e.id);if(n){const t=JSON.parse(e.message),i=n(t.payload);p(t.responseEvent,i)}}));var h,_=100,v=6400,w=class{constructor(e){this.internal=e}get id(){return this.internal.a}get persistentEntity(){return this.internal.b??!1}get uiElements(){return this.internal.c}};function b(e){if(h)throw new Error(c("'init' has already been called"));h=e}function $(){if(!h)throw new Error(c("'init' has not been called"))}function E(){return!!e.get("fluffyalien_energisticscore:ui_disabled_storage_bar_segment")}function S(e){let n;var i,r;$(),e.handlers?.updateUi&&(n=`${e.description.id}__updateUiHandler`,i=n,r=n=>{return e.handlers.updateUi((i=n,{dimension:t.getDimension(i.dimension),x:i.x,y:i.y,z:i.z}));var i},d.set(i,r));p("fluffyalien_energisticscore:ipc.register_machine",{a:e.description.id,b:e.description.persistentEntity,c:e.description.ui?.elements,d:n})}function x(e){$();p("fluffyalien_energisticscore:ipc.register_storage_type",{id:e.id,category:e.category,color:e.color,name:e.name})}function k(e){p("fluffyalien_energisticscore:ipc.update_block_networks",i(e))}function O(e){p("fluffyalien_energisticscore:ipc.update_block_connectable_networks",i(e))}function j(e){p("fluffyalien_energisticscore:ipc.update_block_adjacent_networks",i(e))}function z(e,t){const n=o(t);if(!n)throw new Error(c(`trying to get machine storage of type '${t}' but that storage type does not exist`));return s(n,r(e))??0}function M(e,t,n){if(!e.isValid())throw new Error(c("trying to set machine storage but the block is not valid"));if(n<0)throw new Error(c(`trying to set machine storage of type '${t}' to ${n.toString()} which is less than the minimum value (0)`));if(n>v)throw new Error(c(`trying to set machine storage of type '${t}' to ${n.toString()} which is greater than the maximum value (${v.toString()})`));const i=o(t);if(!i)throw new Error(c(`trying to set machine storage of type '${t}' but that storage type does not exist`));i.setScore(r(e),n)}function R(e,n){const i=r(e),o=s(function(e){const n=`fluffyalien_energisticscore:itemtype${e.toString()}`;return t.scoreboard.getObjective(n)??t.scoreboard.addObjective(n)}(n),i);if(void 0===o)return;const c=s(function(e){const n=`fluffyalien_energisticscore:itemcount${e.toString()}`;return t.scoreboard.getObjective(n)??t.scoreboard.addObjective(n)}(n),i);return c?{typeIndex:o,count:c}:void 0}function J(e,t,n){p("fluffyalien_energisticscore:ipc.set_item_in_machine_slot",{loc:i(e),slot:t,item:n})}function N(e,t,n){p("fluffyalien_energisticscore:ipc.queue_send",{loc:i(e),type:t,amount:n})}function P(e,t,n){const i=z(e,t)+n;i<=0||N(e,t,i)}async function U(e){$();const t=await y("fluffyalien_energisticscore:ipc.get_registered_machine",h.namespace,e);return new w(t)}export{v as MAX_MACHINE_STORAGE,w as RegisteredMachine,_ as STORAGE_AMOUNT_PER_BAR_SEGMENT,P as generate,R as getItemInMachineSlot,z as getMachineStorage,U as getRegisteredMachine,b as init,E as isBedrockEnergisticsCoreInWorld,N as queueSend,S as registerMachine,x as registerStorageType,J as setItemInMachineSlot,M as setMachineStorage,j as updateBlockAdjacentNetworks,O as updateBlockConnectableNetworks,k as updateBlockNetworks};