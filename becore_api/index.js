import{ItemTypes as e}from"@minecraft/server";import{world as n}from"@minecraft/server";var t="0.1.0";function i(e){return{dimension:e.dimension.id,x:e.x,y:e.y,z:e.z}}function r(e){return e.dimension.id+Math.floor(e.x).toString()+Math.floor(e.y).toString()+Math.floor(e.z).toString()}function o(e){const t=`fluffyalien_energisticscore:storage${e}`;return n.scoreboard.getObjective(t)??n.scoreboard.addObjective(t)}function c(e,n){if(e.hasParticipant(n))return e.getScore(n)}function s(e){console.info(function(e,n){return`[Bedrock Energistics Core API v${t}] ${e} ${n}`}("INFO",e))}import{system as a,world as f}from"@minecraft/server";var u=f.getDimension("overworld"),d=new Map,l=new Map;function p(e){d.delete(e)}function g(e,n){u.runCommand(`scriptevent ${e} ${JSON.stringify(n)}`)}var m=0;async function _(e,n,t){const i=`${n}:ipc.internal.handler_response_listener${m.toString()}`;return m++,new Promise(((n,r)=>{const o=a.runTimeout((()=>{p(i),r(new Error(`invoke script event '${e}' timed out: did not recieve a response`))}),20);!function(e,n){d.set(e,n)}(i,(e=>{p(i),a.clearRun(o),n(e)})),g(e,{responseEvent:i,payload:t})}))}a.afterEvents.scriptEventReceive.subscribe((e=>{const n=d.get(e.id);if(n)return void n(JSON.parse(e.message));const t=l.get(e.id);if(t){const n=JSON.parse(e.message),i=t(n.payload);g(n.responseEvent,i)}}));var v,y=100,b=6400;function $(e){if(v)throw new Error("'init' has already been called");v=e}function h(){if(!v)throw new Error("'init' has not been called")}function w(){return!!e.get("fluffyalien_energisticscore:ui_disabled_storage_bar_segment")}function S(e){let t;var i,r;h(),s(`sending register machine event for '${e.description.id}' (from '${v.namespace}')`),e.handlers?.updateUi&&(t=`${e.description.id}__updateUiHandler`,i=t,r=t=>{return e.handlers.updateUi((i=t,{dimension:n.getDimension(i.dimension),x:i.x,y:i.y,z:i.z}));var i},l.set(i,r));g("fluffyalien_energisticscore:ipc.register_machine",{description:e.description,updateUiEvent:t})}function O(e){h(),s(`sending register storage type event for '${e.id}' (from '${v.namespace}')`);g("fluffyalien_energisticscore:ipc.register_storage_type",{id:e.id,color:e.color,name:e.name})}function E(e){g("fluffyalien_energisticscore:ipc.update_block_network",i(e))}function j(e){g("fluffyalien_energisticscore:ipc.update_block_adjacent_networks",i(e))}function x(e,n){return c(o(n),r(e))??0}function k(e,n,t){o(n).setScore(r(e),t)}function z(e,t){const i=r(e),o=c(function(e){const t=`fluffyalien_energisticscore:itemtype${e.toString()}`;return n.scoreboard.getObjective(t)??n.scoreboard.addObjective(t)}(t),i);if(void 0===o)return;const s=c(function(e){const t=`fluffyalien_energisticscore:itemcount${e.toString()}`;return n.scoreboard.getObjective(t)??n.scoreboard.addObjective(t)}(t),i);return s?{typeIndex:o,count:s}:void 0}function M(e,n,t){g("fluffyalien_energisticscore:ipc.set_item_in_machine_slot",{loc:i(e),slot:n,item:t})}function N(e,n,t){g("fluffyalien_energisticscore:ipc.queue_send",{loc:i(e),type:n,amount:t})}function U(e,n,t){const i=x(e,n)+t;i<=0||N(e,n,i)}function I(e){return h(),_("fluffyalien_energisticscore:ipc.get_registered_machine",v.namespace,e)}export{b as MAX_MACHINE_STORAGE,y as STORAGE_AMOUNT_PER_BAR_SEGMENT,U as generate,z as getItemInMachineSlot,x as getMachineStorage,I as getRegisteredMachine,$ as init,w as isBedrockEnergisticsCoreInWorld,N as queueSend,S as registerMachine,O as registerStorageType,M as setItemInMachineSlot,k as setMachineStorage,j as updateBlockAdjacentNetworks,E as updateBlockNetwork};