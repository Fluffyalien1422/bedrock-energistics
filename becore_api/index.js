import{ItemTypes as e,system as t}from"@minecraft/server";import{world as n}from"@minecraft/server";var i="0.1.0";function r(e){return{dimension:e.dimension.id,x:e.x,y:e.y,z:e.z}}function o(e){return e.dimension.id+Math.floor(e.x).toString()+Math.floor(e.y).toString()+Math.floor(e.z).toString()}function s(e){const t=`fluffyalien_energisticscore:storage${e}`;return n.scoreboard.getObjective(t)}function c(e,t){if(e.hasParticipant(t))return e.getScore(t)}function a(e){return function(e,t){return`[Bedrock Energistics Core API v${i}] ${e} ${t}`}("ERROR",e)}import{system as f,world as u}from"@minecraft/server";var l=u.getDimension("overworld"),d=new Map,g=new Map;function p(e){d.delete(e)}function m(e,t){l.runCommand(`scriptevent ${e} ${JSON.stringify(t)}`)}var y=0;async function h(e,t,n){const i=`${t}:ipc.internal.handler_response_listener${y.toString()}`;return y++,new Promise(((t,r)=>{const o=f.runTimeout((()=>{p(i),r(new Error(`invoke script event '${e}' timed out: did not recieve a response`))}),20);!function(e,t){d.set(e,t)}(i,(e=>{p(i),f.clearRun(o),t(e)})),m(e,{responseEvent:i,payload:n})}))}f.afterEvents.scriptEventReceive.subscribe((e=>{const t=d.get(e.id);if(t)return void t(JSON.parse(e.message));const n=g.get(e.id);if(n){const t=JSON.parse(e.message),i=n(t.payload);m(t.responseEvent,i)}}));var _,v=100,b=6400,w=class{constructor(e){this.internal=e}get id(){return this.internal.a}get persistentEntity(){return this.internal.b??!1}get uiElements(){return this.internal.c}};function $(e){if(_)throw new Error(a("'init' has already been called"));_=e}function E(){if(!_)throw new Error(a("'init' has not been called"))}function S(){return!!e.get("fluffyalien_energisticscore:ui_disabled_storage_bar_segment")}function x(e){let t;var i,r;E(),e.handlers?.updateUi&&(t=`${e.description.id}__updateUiHandler`,i=t,r=t=>{return e.handlers.updateUi((i=t,{dimension:n.getDimension(i.dimension),x:i.x,y:i.y,z:i.z}));var i},g.set(i,r));m("fluffyalien_energisticscore:ipc.register_machine",{a:e.description.id,b:e.description.persistentEntity,c:e.description.ui?.elements,d:t})}function O(e){E();m("fluffyalien_energisticscore:ipc.register_storage_type",{id:e.id,category:e.category,color:e.color,name:e.name})}function k(e){m("fluffyalien_energisticscore:ipc.update_block_networks",r(e))}function j(e){m("fluffyalien_energisticscore:ipc.update_block_connectable_networks",r(e))}function z(e){m("fluffyalien_energisticscore:ipc.update_block_adjacent_networks",r(e))}function M(e,t){const n=s(t);if(!n)throw new Error(a(`trying to get machine storage of type '${t}' but that storage type does not exist`));return c(n,o(e))??0}function R(e,t,n){if(!e.isValid())throw new Error(a("trying to set machine storage but the block is not valid"));if(n<0)throw new Error(a(`trying to set machine storage of type '${t}' to ${n.toString()} which is less than the minimum value (0)`));if(n>b)throw new Error(a(`trying to set machine storage of type '${t}' to ${n.toString()} which is greater than the maximum value (${b.toString()})`));const i=s(t);if(!i)throw new Error(a(`trying to set machine storage of type '${t}' but that storage type does not exist`));i.setScore(o(e),n)}function P(e,t){const i=o(e),r=c(function(e){const t=`fluffyalien_energisticscore:itemtype${e.toString()}`;return n.scoreboard.getObjective(t)??n.scoreboard.addObjective(t)}(t),i);if(void 0===r)return;const s=c(function(e){const t=`fluffyalien_energisticscore:itemcount${e.toString()}`;return n.scoreboard.getObjective(t)??n.scoreboard.addObjective(t)}(t),i);return s?{typeIndex:r,count:s}:void 0}function J(e,t,n){m("fluffyalien_energisticscore:ipc.set_item_in_machine_slot",{loc:r(e),slot:t,item:n})}function N(e,t,n){m("fluffyalien_energisticscore:ipc.queue_send",{loc:r(e),type:t,amount:n})}function U(e,t,n){const i=M(e,t)+n;i<=0||N(e,t,i)}async function C(e){E();const t=await h("fluffyalien_energisticscore:ipc.get_registered_machine",_.namespace,e);return new w(t)}function D(e){k(e),t.run((()=>{!function(e){const t=o(e);for(const e of n.scoreboard.getObjectives())e.removeParticipant(t)}(e)}))}export{b as MAX_MACHINE_STORAGE,w as RegisteredMachine,v as STORAGE_AMOUNT_PER_BAR_SEGMENT,U as generate,P as getItemInMachineSlot,M as getMachineStorage,C as getRegisteredMachine,$ as init,S as isBedrockEnergisticsCoreInWorld,N as queueSend,x as registerMachine,O as registerStorageType,D as removeMachine,J as setItemInMachineSlot,R as setMachineStorage,z as updateBlockAdjacentNetworks,j as updateBlockConnectableNetworks,k as updateBlockNetworks};