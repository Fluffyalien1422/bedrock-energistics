import{world as e}from"@minecraft/server";function n(e){return{dimension:e.dimension.id,x:e.x,y:e.y,z:e.z}}function t(e){return e.dimension.id+Math.floor(e.x).toString()+Math.floor(e.y).toString()+Math.floor(e.z).toString()}function i(n){const t=`fluffyalien_energisticscore:storage${n}`;return e.scoreboard.getObjective(t)??e.scoreboard.addObjective(t)}function r(e,n){if(e.hasParticipant(n))return e.getScore(n)}import{system as o,world as c}from"@minecraft/server";var s=c.getDimension("overworld"),a=new Map,f=new Map;function u(e){a.delete(e)}function d(e,n){s.runCommand(`scriptevent ${e} ${JSON.stringify(n)}`)}var l=0;async function p(e,n,t){const i=`${n}:ipc.internal.handler_response_listener${l.toString()}`;return l++,new Promise(((n,r)=>{const c=o.runTimeout((()=>{u(i),r(new Error(`invoke script event '${e}' timed out: did not recieve a response`))}),20);!function(e,n){a.set(e,n)}(i,(e=>{u(i),o.clearRun(c),n(e)})),d(e,{responseEvent:i,payload:t})}))}function g(n){let t;var i,r;n.handlers?.updateUi&&(t=`${n.description.id}__updateUiHandler`,i=t,r=t=>{return n.handlers.updateUi((i=t,{dimension:e.getDimension(i.dimension),x:i.x,y:i.y,z:i.z}));var i},f.set(i,r));d("fluffyalien_energisticscore:ipc.register_machine",{description:n.description,updateUiEvent:t})}function m(e){d("fluffyalien_energisticscore:ipc.update_block_network",n(e))}function v(e){d("fluffyalien_energisticscore:ipc.update_block_adjacent_networks",n(e))}function _(e,n){return r(i(n),t(e))??0}function y(e,n,r){i(n).setScore(t(e),r)}function b(n,i){const o=t(n),c=r(function(n){const t=`fluffyalien_energisticscore:itemtype${n.toString()}`;return e.scoreboard.getObjective(t)??e.scoreboard.addObjective(t)}(i),o);if(void 0===c)return;const s=r(function(n){const t=`fluffyalien_energisticscore:itemcount${n.toString()}`;return e.scoreboard.getObjective(t)??e.scoreboard.addObjective(t)}(i),o);return s?{type:c,count:s}:void 0}function S(e,n,t){d("fluffyalien_energisticscore:ipc.set_item_in_machine_slot",{loc:e,slot:n,item:t})}function h(e,t,i){d("fluffyalien_energisticscore:ipc.queue_send",{loc:n(e),type:t,amount:i})}function O(e,n,t){const i=_(e,n)+t;i<=0||h(e,n,i)}function $(e,n){return p("fluffyalien_energisticscore:ipc.get_registered_machine",n,e)}o.afterEvents.scriptEventReceive.subscribe((e=>{const n=a.get(e.id);if(n)return void n(JSON.parse(e.message));const t=f.get(e.id);if(t){const n=JSON.parse(e.message),i=t(n.payload);d(n.responseEvent,i)}}));export{O as generate,b as getItemInMachineSlot,_ as getMachineStorage,$ as getRegisteredMachine,h as queueSend,g as registerMachine,S as setItemInMachineSlot,y as setMachineStorage,v as updateBlockAdjacentNetworks,m as updateBlockNetwork};